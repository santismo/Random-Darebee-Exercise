<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Random DAREBEE Workout Picker</title>

<style>
  :root{
    --bg:#0b0c10;
    --panel:#12141b;
    --panel2:#0f1118;
    --text:#e7e9ee;
    --muted:#a0a6b5;
    --accent:#7aa2ff;
    --border:rgba(255,255,255,.08);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    min-height:100vh;
    background:linear-gradient(180deg, var(--bg), #07080c);
    color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  }
  .wrap{
    max-width:1100px;
    margin:0 auto;
    padding:18px;
  }
  .top{
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:14px;
    padding:14px;
    box-shadow:0 20px 60px rgba(0,0,0,.45);
  }
  h1{
    margin:0 0 10px;
    font-size:1.15rem;
    font-weight:700;
    letter-spacing:.2px;
  }
  .row{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
  }
  .row > *{flex:1 1 160px}
  label{
    display:block;
    font-size:.82rem;
    color:var(--muted);
    margin:0 0 6px;
  }
  select, input[type="number"]{
    width:100%;
    padding:10px 12px;
    border-radius:10px;
    border:1px solid var(--border);
    background:var(--panel2);
    color:var(--text);
    outline:none;
  }
  button{
    width:100%;
    padding:11px 12px;
    border-radius:10px;
    border:none;
    background:var(--accent);
    color:#0b0c10;
    font-weight:800;
    cursor:pointer;
  }
  button:disabled{opacity:.55; cursor:not-allowed}
  #status{
    margin-top:10px;
    color:var(--muted);
    font-size:.9rem;
    min-height:1.1em;
  }

  .grid{
    margin-top:14px;
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(170px, 1fr));
    gap:10px;
  }
  .tile{
    display:block;
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:14px;
    overflow:hidden;
    text-decoration:none;
    color:inherit;
    position:relative;
  }
  .tile img{
    width:100%;
    height:220px;
    object-fit:cover;
    display:block;
    background:#0a0b10;
  }
  .cap{
    padding:10px 10px 11px;
    font-size:.85rem;
    color:var(--muted);
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .badge{
    position:absolute;
    left:10px;
    top:10px;
    background:rgba(0,0,0,.55);
    border:1px solid rgba(255,255,255,.12);
    color:var(--text);
    padding:4px 8px;
    border-radius:999px;
    font-size:.78rem;
    backdrop-filter: blur(6px);
  }
</style>
</head>

<body>
<div class="wrap">
  <div class="top">
    <h1>Random DAREBEE Workouts</h1>

    <div class="row">
      <div>
        <label for="count">How many to show</label>
        <select id="count">
          <option value="6">6</option>
          <option value="12" selected>12</option>
          <option value="24">24</option>
          <option value="36">36</option>
        </select>
      </div>

      <div>
        <label>&nbsp;</label>
        <button id="reroll">Reroll</button>
      </div>
    </div>

    <div id="status"></div>
  </div>

  <div class="grid" id="grid"></div>
</div>

<script>
  const grid = document.getElementById("grid");
  const statusEl = document.getElementById("status");
  const rerollBtn = document.getElementById("reroll");
  const countEl = document.getElementById("count");

  let WORKOUT_URLS = null;

  function setStatus(msg){ statusEl.textContent = msg; }

  function uniqueRandomIndices(n, max){
    const set = new Set();
    while(set.size < Math.min(n, max)){
      set.add(Math.floor(Math.random() * max));
    }
    return Array.from(set);
  }

  // Convert workout page URL -> image URL
  // https://darebee.com/workouts/<slug>.html  => https://darebee.com/images/workouts/<slug>.jpg
  function workoutPageToImage(pageUrl){
    const u = new URL(pageUrl);
    const slugHtml = u.pathname.split("/").pop();   // "<slug>.html"
    const slug = slugHtml.replace(/\.html$/i, "");  // "<slug>"
    return `https://darebee.com/images/workouts/${slug}.jpg`;
  }

  // Show a tile, and if the image errors (404), replace with another random workout.
  function makeTile(pageUrl, indexLabel){
    const a = document.createElement("a");
    a.className = "tile";
    a.href = pageUrl;
    a.target = "_blank";
    a.rel = "noopener noreferrer";

    const badge = document.createElement("div");
    badge.className = "badge";
    badge.textContent = `#${indexLabel}`;
    a.appendChild(badge);

    const img = document.createElement("img");
    img.loading = "lazy";

    const cap = document.createElement("div");
    cap.className = "cap";
    cap.textContent = new URL(pageUrl).pathname.split("/").pop().replace(/\.html$/i, "");

    function setFromPage(url){
      img.src = workoutPageToImage(url);
      a.href = url;
      cap.textContent = new URL(url).pathname.split("/").pop().replace(/\.html$/i, "");
    }

    img.onerror = () => {
      // Replace with a new random one
      if (!WORKOUT_URLS || !WORKOUT_URLS.length) return;
      const replacement = WORKOUT_URLS[Math.floor(Math.random() * WORKOUT_URLS.length)];
      setFromPage(replacement);
    };

    setFromPage(pageUrl);

    a.appendChild(img);
    a.appendChild(cap);
    return a;
  }

  async function loadWorkoutsJSON(){
    const jsonURL = new URL("workouts.json", window.location.href).toString();
    const res = await fetch(jsonURL, { cache: "no-store", headers: { "Accept": "application/json" }});
    if (!res.ok) throw new Error(`Failed to load workouts.json (HTTP ${res.status})`);
    const data = await res.json();
    const urls = Array.isArray(data) ? data : data.urls;
    if (!Array.isArray(urls) || !urls.length) throw new Error("workouts.json has no URLs");
    return urls;
  }

  async function render(){
    rerollBtn.disabled = true;
    try{
      setStatus("Loading workouts.json…");
      if (!WORKOUT_URLS) WORKOUT_URLS = await loadWorkoutsJSON();

      const n = parseInt(countEl.value, 10) || 12;
      const picks = uniqueRandomIndices(n, WORKOUT_URLS.length).map(i => WORKOUT_URLS[i]);

      grid.innerHTML = "";
      setStatus(`Showing ${picks.length} random workouts…`);

      picks.forEach((url, i) => grid.appendChild(makeTile(url, i + 1)));

    } catch (e){
      console.error(e);
      setStatus("Error: " + e.message);
    } finally {
      rerollBtn.disabled = false;
    }
  }

  rerollBtn.addEventListener("click", render);
  countEl.addEventListener("change", render);

  render();
</script>
</body>
</html>